# TCP/IP 体系特点

对于一个对象，有两种方法：

1. ISO/OSI 网络七层模型
2. TCP/IP 网络四层模型



## 1. 七层模型

网络设计者在解决网络体系结构时经常使用 OSI 七层。

总共为：物理，数据链路，网络，传输，会话，表示，应用。

![1](./img/1.png)

实际遇到的设备和机器，往往可以用 OSI 7层分解。但是很少见到机器可以一一对应它们。比如说，datalink层也有可能直接和在了physical中。在早期时，可能会分得很开，但是现在都集成了。

至于记忆：左边。



比如 A 给 B 发一个email，使用 word 之类的字符编辑器编辑一个文件。此为应用层。之后打包成 TCP/IP，可能对其进行一个转化，比如 base64 编码。网卡。传输，收到了解析出来。



七层，每一层干的事情都不一样。

1. 文字，字符的转换。

2. 有一些需要指定的人才看得到，有些都可以看得到，怎么实现？比如账号的密码。（在哪一层实现

3. 如何传输的更快？更加的准确？做 base64 最小的 size 是多少？（超过了要分开，要重组）适应带宽和分组。
4. 网络间寻址如何
5. 数据流……
6. 电气信号……

![2](./img/3-2.png)

从数据形态来看，有 4 中状态：数据段，数据包，数据帧，比特位。

如果 physical 是标准的 xxxx（没听清）的网线，调制解调器（？

要分清在不同的层都在干什么。每一层处理的事情不同，所以面临的安全问题也不同。比如物理层处理的是信号的传递。

![3-3](./img/3-3.png)

展现了从应用 X 到应用 Y 其底层是如何对应的。

（这个图表示的就是数据形态）

在不同的层面，数据形态不同，处理的问题也就不同。所有的数据信息在每一层都有体现，在物理层，一定有上面应用层的数据。但是妄图从物理层还原应用层的数据，这是可能的，但是会消耗很多资源。

在物理层，有A到B节点的信息，有直接的体现，但是在应用层却不一定有这些数据的体现。编程时，需要将工作落实到对应的层上。

如果说允许 A 的笔记本可以传到 B 的笔记本上，物理层上很容易做到。只需要看 A 机器的标识和 B 的机器表示，在物理层做访问控制。但是在网络层可能就是端口，IP，在应用层可能就是 A 同学的名字，Windows 假名之类的。



![4](./img/3-4.png)



## 2. TCP/IP

四层架构。

![5](./img/3-5.png)

一个笔记本装了 Win10 + sql server + 其他套件，作业里用两种模型分析。

在现实生活当中，没有严格 OSI 的理想对应。

如果用TCP/IP 4 层进行分解，每一层都可以进行分解，对应，编程。

TCP/IP 4层的应用层基本涵盖了 OSI 7层的上面三层。

物理层是对应着数据链路和物理层两层，实际上也是如此。因为都是嵌在一起的。都是bit stream，电信号进行的传输。

信息安全，对象的分解很重要。都是用这两个模型进行分解。



以一个手机为例，Android 手机，每一层都不可能全都是软件或者全部都是硬件。

1. 物理层上来看，手机电池，手机主板，手机屏幕。
2. 网络接口：运营商的数据通道，无线数据链路，支持多种链路接口，WIFI接口，MINI USB接口，内存扩展，SDK，红外，蓝牙接口。有些接口是高度集成化，写在芯片主板上。火线1394。（？
3. 网络层：涉及协议转换，和 IP，IP包有面向连接或者不面向链接的。
4. 应用层：与装载的应用有关。



![6](./img/3-6.png)

展现了每一层，跑的是什么东西。

### 1.物理接口层

不同的设备类型，其接口上跑的包是不一样的。光纤，IGSIM 网线，手机通信，和物理存在的协议有关。

### 2. 网络层

协议不清楚没关系……自己查一查……

比如说设备，手机，笔记本，接入网络。一定有一个路由和交换机，其如何知道我的设备在？请求和给我发包，如果被我无视，那么我就上不了网。

我在接入网的时候，要告诉它我在哪里。在相当长的一段时间，我都能联网。

如果我不做声明， 不发ARP网包，那么我有的时候就连不上网。实际上，应该在初始化时发一个 ARP 网包，告诉我在。

如果我不想让别人知道我在，但是我又的确在，那么也应该这个网络层做处理。（网络黑洞）第三层不仅仅有典型意义上的 IP 包，也还有其他东西。

不能简单说第三层有简单的 IP包，还有其他东西，也可以说其他的东西也是特殊的 IP 包，但是实际上很复杂。

### 3. 传输层

只有 TCP 和 UDP 包。

TCP 面向连接。UDP 传出去就不管了。

TCP 如果对方没有收到，会重新传输。但是 UDP 传了就不管了。UDP 传输之后，带宽就释放出来了。

如果是传比较大的文件，那么就用 UDP 包，而进行身份验证，就是用前者。

### 4. 应用层

做地址解析DNS，TCP 和 UDP 都可以做。TCP 做和 UDP 做都有其好处和坏处。

（如果第一次访问的时候，是要进行缓存，之后做的时候，就不需要很长时间，直接查询缓存就可以。DNS 劫持，本来访问的是a，但是去了b。）（这用了哪一个呢）



如果想把别人的 TCP 包截获。如果服务器要求认证，那么用户A的用户名和口令应该使用TCP传的，我如果要截获，分析其可能传输这些东西的 Session，在比较低的层做反而要容易一些，我或许就可以知道其要走哪些网络层的协议。

但是如果我要识别特殊的应用，虽然说在底层的数据包括了上面的所有数据，但是进行还原进行一步步的解包非常的麻烦，占用了很多的资源。在比较高层做要容易一些。

有时仅仅一层搞不定，需要多层联系



![7](./img/3-7.png)

![7](./img/3-8.png)

![7](./img/3-9.png)



## 3. 思考题

比如一个 X86 的架构，从 OSI 视角剖析终端计算机。

![7](./img/3-10.png)

### 1. TCP/IP 4层

物理层：主板，屏幕，电池

数据链路：1.孔口华英电路，双卡双待->8，可能双卡双通，也可能单通。 3.wifi口。4.MINI USB 口。5.蓝牙。6.红外。都会对应手机的主板、芯片上。有些接口是直接嵌入了物理层的xxx（Ix?C）里面

网络层：软硬件的组件都有。解码器，把不同的信息都变成了 IP。IPsec。对应的软件功能包。TS,SL。

应用层：本地的照相机，重力检测器。

![3-11](./img/3-11.png)



## 4. 攻防，对抗，动态，争衡

因为数据，信息有价值，所以才会有信息安全一说。

![3-12](./img/3-12.png)

外部访问都到 DMZ 区为止。

层次架构。外部访问也有防火墙。但是防火墙可能被渗透过去。

![3-13](./img/3-13.png)

有些软件可以自动化地攻击。所以攻击变得容易了。

1. 攻击者先用网络漏洞发现网络里有什么是感兴趣的，有价值的目标。

2. 之后在看漏洞有没有。
3. 再看第三方有没有工具可以利用这些漏洞。

![1](./img/3-1.png)

### 1. 通讯加密

通讯加密：让传输的内容，让不相干的人在某一个时间段中读不懂。依靠的就是数据的编码和传统的密码学，只进行了传统的数据加密。核心是**加密解密技术**。

虽然可以解决一些问题，但不能解决全部。

如果 A 机器在做加密的过程中被监控了，尽管不知道密码加密方式，但是还是不安全的。因为被别人听到了。尽管听不懂。

### 2. 安全防护

美国国防将安全等级划分为 7 层。在安全防护阶段，在加密上还加了访问控制等。

重点在于主机安全，保护服务器的安全。网络隔离，访问控制，鉴别认证都是技术措施。但是这些技术是否可以得到切实的执行也很重要。第二阶段没有将安全服务加入到防护当中。

### 3. 保障体系

最终发展到了 ITF，不可能把所有的主机安全都保证，只需要保护重点的就可以了。除了通信安全之外，还要把安全技术操作做出来一个生态出来。强调的是管理，人，技术，操作的关系。



这三个并不是排斥的关系：

通讯保密，PCsec（主机安全）ITF（保障体系）。

在早期就没什么体系架构。



无论是什么系统，都有一个典型的保护机制。

国际上一般认为有 5 道屏障。

![14](./img/3-14.png)

最外面是现实生活当中的，区域控制，门禁体系。有人、设备、技术的结合。

第二层是信安发展的前面两层。

第三层是安全运维管理体系。

第四层是不怕干坏事，干了坏事有法律惩罚。



管理、法律如果没有技术的支持，这些屏障也没有意义。物理屏障没有技术支持，也没有意义。



信息安全的经典体系结构：

![15](./img/3-15.png)

适用于典型的主机安全、节点安全。

以一个系统举例，系统的核心数据都在一个服务器里面。

1. 先对一个服务器进行 OSI 7 层分解，每一层都看有哪些服务。
2. 然后看对应7层，看看有哪些安全机制。
3. 基于这些安全机制，看能够提供哪些安全服务。

安全机制相当于源操作，base。安全服务是基于多个安全机制实现的。

一个安全服务可以基于一个或者多个安全机制的组合实现。



虽然文字上来看，安全机制和安全服务里都有“访问控制”、“数据完整性”。但是它们的意义不同。

安全机制里面，可能对一个值进行hash，对hash之后的值进行比较。（？

但是对于安全服务，hash值相等也不一定代表其就是源数据。（我听错了貌似这个逻辑不是这样的？



**（老师十分建议下载 英文版 ISO 7498-2）**